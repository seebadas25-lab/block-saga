(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();const d={GRID_SIZE:8,COLOR_BG:"#FFFFFF",COLOR_GRID_EMPTY:"#F0F0F0",BLOCK_COLORS:["#FF3366","#00C853","#2979FF","#FFD600","#AA00FF","#FF6D00"]};class S{constructor(){this.size=d.GRID_SIZE,this.cells=Array(this.size).fill(null).map(()=>Array(this.size).fill(null))}canPlace(t,e,i){const s=i.length,n=i[0].length;for(let h=0;h<s;h++)for(let l=0;l<n;l++)if(i[h][l]!==0){const r=t+l,o=e+h;if(r<0||r>=this.size||o<0||o>=this.size||this.cells[o][r]!==null)return!1}return!0}place(t,e,i,s){const n=i.length,h=i[0].length;for(let l=0;l<n;l++)for(let r=0;r<h;r++)i[l][r]!==0&&(this.cells[e+l][t+r]={color:s})}checkLines(){const t={rows:[],cols:[]};for(let e=0;e<this.size;e++)this.cells[e].every(i=>i!==null)&&t.rows.push(e);for(let e=0;e<this.size;e++){let i=!0;for(let s=0;s<this.size;s++)if(this.cells[s][e]===null){i=!1;break}i&&t.cols.push(e)}return t}clearLines(t){t.rows.forEach(e=>{for(let i=0;i<this.size;i++)this.cells[e][i]=null}),t.cols.forEach(e=>{for(let i=0;i<this.size;i++)this.cells[i][e]=null})}}class E{constructor(t,e){this.canvas=t,this.ctx=t.getContext("2d"),this.grid=e,this.resize(),window.addEventListener("resize",()=>this.resize())}resize(){const t=window.devicePixelRatio||1,e=1.5;let i,s;window.innerWidth<=768?(i=window.innerWidth-30,s=window.innerHeight-100-20):(i=window.innerWidth-220,s=window.innerHeight*.9);let n=i,h=n*e;h>s&&(h=s,n=h/e),n=Math.floor(n),h=Math.floor(h),this.canvas.style.width=`${n}px`,this.canvas.style.height=`${h}px`,this.canvas.width=n*t,this.canvas.height=h*t,this.ctx.scale(t,t),this.width=n,this.height=h,this.cellSize=(this.width-20)/d.GRID_SIZE,this.padding=10,this.gridEnd=this.width,this.trayTop=this.gridEnd+20}draw(t){this.ctx.fillStyle=d.COLOR_BG,this.ctx.fillRect(0,0,this.width,this.height),this.ctx.fillStyle="#fafafa",this.ctx.fillRect(0,this.width,this.width,this.height-this.width),this.ctx.strokeStyle="#eee",this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(0,this.width),this.ctx.lineTo(this.width,this.width),this.ctx.stroke(),this.drawGrid(),t&&t.isDragging&&(this.drawDragShadow(t),this.drawFloatingBlock(t))}drawGrid(){const{GRID_SIZE:t,COLOR_GRID_EMPTY:e}=d;this.ctx.translate(this.padding,this.padding);for(let i=0;i<t;i++)for(let s=0;s<t;s++){const n=s*this.cellSize,h=i*this.cellSize;this.ctx.fillStyle=e;const l=this.grid.cells[i][s];l?(this.ctx.fillStyle=l.color,this.ctx.shadowBlur=10,this.ctx.shadowColor=l.color):this.ctx.shadowBlur=0,this.roundRect(n+1,h+1,this.cellSize-2,this.cellSize-2,4),this.ctx.fill()}this.ctx.translate(-this.padding,-this.padding),this.ctx.shadowBlur=0}drawFloatingBlock(t){const{shape:e,x:i,y:s,color:n}=t;if(!e)return;const h=e[0].length*this.cellSize,l=e.length*this.cellSize,r=i-h/2,o=s-l/2;this.ctx.fillStyle=n,this.ctx.shadowBlur=15,this.ctx.shadowColor=n,e.forEach((a,g)=>{a.forEach((u,f)=>{u&&(this.roundRect(r+f*this.cellSize+1,o+g*this.cellSize+1,this.cellSize-2,this.cellSize-2,4),this.ctx.fill())})}),this.ctx.shadowBlur=0}drawDragShadow(t){const{gridX:e,gridY:i,shape:s,valid:n}=t;e===null||i===null||!n||(this.ctx.translate(this.padding,this.padding),this.ctx.fillStyle="rgba(255, 255, 255, 0.2)",s.forEach((h,l)=>{h.forEach((r,o)=>{r&&(this.roundRect((e+o)*this.cellSize+1,(i+l)*this.cellSize+1,this.cellSize-2,this.cellSize-2,4),this.ctx.fill())})}),this.ctx.translate(-this.padding,-this.padding))}roundRect(t,e,i,s,n){this.ctx.beginPath(),this.ctx.roundRect(t,e,i,s,n),this.ctx.closePath()}}class L{constructor(t,e){this.canvas=t,this.game=e,this.handleDown=this.handleDown.bind(this),this.handleMove=this.handleMove.bind(this),this.handleUp=this.handleUp.bind(this),this.setupListeners()}setupListeners(){this.canvas.style.touchAction="none",this.canvas.addEventListener("pointerdown",this.handleDown),window.addEventListener("pointermove",this.handleMove),window.addEventListener("pointerup",this.handleUp),window.addEventListener("pointercancel",this.handleUp)}getCoords(t){const e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}handleDown(t){t.preventDefault();const{x:e,y:i}=this.getCoords(t);this.game.onPointerDown(e,i)}handleMove(t){const{x:e,y:i}=this.getCoords(t);this.game.onPointerMove(e,i)}handleUp(t){this.game.onPointerUp()}}const m={SINGLE:[[1]],I2:[[1,1]],I2_V:[[1],[1]],I3:[[1,1,1]],I3_V:[[1],[1],[1]],I4:[[1,1,1,1]],I4_V:[[1],[1],[1],[1]],I5:[[1,1,1,1,1]],I5_V:[[1],[1],[1],[1],[1]],O:[[1,1],[1,1]],O3:[[1,1,1],[1,1,1],[1,1,1]],L2:[[1,0],[1,1]],L2_R0:[[1,1],[1,0]],L2_R1:[[1,1],[0,1]],L2_R2:[[0,1],[1,1]],L3:[[1,0],[1,0],[1,1]],L3_90:[[1,1,1],[1,0,0]],L3_180:[[1,1],[0,1],[0,1]],L3_270:[[0,0,1],[1,1,1]],J3:[[0,1],[0,1],[1,1]],J3_90:[[1,0,0],[1,1,1]],T:[[1,1,1],[0,1,0]],T_90:[[0,1],[1,1],[0,1]],T_180:[[0,1,0],[1,1,1]],T_270:[[1,0],[1,1],[1,0]]},z=()=>{const c=Object.keys(m),t=c[Math.floor(Math.random()*c.length)];return{name:t,shape:m[t]}};class R{constructor(t,e,i){this.x=t,this.y=e,this.color=i,this.vx=(Math.random()-.5)*4,this.vy=(Math.random()-.5)*4,this.life=1,this.size=Math.random()*5+2}update(){this.x+=this.vx,this.y+=this.vy,this.life-=.02,this.size*=.95}draw(t){t.fillStyle=this.color,t.globalAlpha=this.life,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill(),t.globalAlpha=1}}class k{constructor(){this.canvas=document.getElementById("gameCanvas"),this.grid=new S,this.renderer=new E(this.canvas,this.grid),this.input=new L(this.canvas,this),this.score=0,this.bestScore=localStorage.getItem("block-blast-best")||0,this.combo=0,this.hand=[],this.particles=[],this.dragState={isDragging:!1,blockIndex:-1,shape:null,color:null,x:0,y:0,gridX:null,gridY:null,valid:!1},this.initHand(),this.updateUI(),this.lastTime=0,this.loop=this.loop.bind(this),requestAnimationFrame(this.loop)}initHand(){this.hand=[];for(let t=0;t<3;t++)this.addBlockToHand(t)}addBlockToHand(t){const{shape:e}=z(),i=d.BLOCK_COLORS[Math.floor(Math.random()*d.BLOCK_COLORS.length)];this.hand[t]={shape:e,color:i,width:e[0].length,height:e.length}}loop(t){if(t-this.lastTime,this.lastTime=t,this.renderer.draw(this.dragState),this.drawHand(),this.particles.length>0){this.renderer.ctx.save();for(let e=this.particles.length-1;e>=0;e--){const i=this.particles[e];i.update(),i.draw(this.renderer.ctx),i.life<=0&&this.particles.splice(e,1)}this.renderer.ctx.restore()}requestAnimationFrame(this.loop)}onPointerDown(t,e){const i=this.renderer.width,s=this.renderer.height-i,n=i+s/2,l=this.renderer.width/3;for(let r=0;r<3;r++){const o=this.hand[r];if(!o)continue;const a=r*l+l/2,g=n,f=this.renderer.cellSize*.6,p=o.shape[0].length*f,w=o.shape.length*f;if(t>=a-p/2-30&&t<=a+p/2+30&&e>=g-w/2-30&&e<=g+w/2+30){this.startDrag(r,t,e);break}}}startDrag(t,e,i){const s=this.hand[t];this.dragState={isDragging:!0,blockIndex:t,shape:s.shape,color:s.color,x:e,y:i,gridX:null,gridY:null,valid:!1}}onPointerMove(t,e){if(!this.dragState.isDragging)return;this.dragState.x=t,this.dragState.y=e;const i=this.renderer,s=this.dragState.shape[0].length*i.cellSize,n=this.dragState.shape.length*i.cellSize,h=t-s/2,l=e-n/2,r=(h-i.padding)/i.cellSize,o=(l-i.padding)/i.cellSize,a=Math.round(r),g=Math.round(o);this.dragState.gridX=a,this.dragState.gridY=g,this.dragState.valid=this.grid.canPlace(a,g,this.dragState.shape)}onPointerUp(){this.dragState.isDragging&&(this.dragState.valid?this.placeBlock():console.log("Invalid placement"),this.dragState.isDragging=!1,this.dragState.blockIndex=-1)}placeBlock(){const{gridX:t,gridY:e,shape:i,color:s,blockIndex:n}=this.dragState;this.grid.place(t,e,i,s),this.hand[n]=null;const h=this.grid.checkLines(),l=h.rows.length+h.cols.length;if(l>0){this.combo++,this.spawnClearParticles(h),this.grid.clearLines(h);const r=l*10+this.combo*10;this.addScore(r),this.combo>1?this.showFloatingText(`COMBO x${this.combo}!`,this.dragState.x,this.dragState.y):l>1&&this.showFloatingText("PERFECT!",this.dragState.x,this.dragState.y)}else this.combo=0,this.addScore(10);this.hand.every(r=>r===null)&&this.initHand(),this.checkGameOver()}addScore(t){this.score+=t,this.score>this.bestScore&&(this.bestScore=this.score,localStorage.setItem("block-blast-best",this.bestScore)),this.updateUI()}showFloatingText(t,e,i){const s=document.createElement("div");s.className="floating-text",s.innerText=t,s.style.left=e+"px",s.style.top=i+"px",document.getElementById("ui-layer").appendChild(s),setTimeout(()=>s.remove(),1e3)}checkGameOver(){let t=!1;for(const e of this.hand)if(e){for(let i=0;i<d.GRID_SIZE;i++){for(let s=0;s<d.GRID_SIZE;s++)if(this.grid.canPlace(s,i,e.shape)){t=!0;break}if(t)break}if(t)break}!t&&!this.hand.every(e=>e===null)&&(alert("Game Over! Score: "+this.score),this.reset())}reset(){this.grid=new S,this.renderer.grid=this.grid,this.score=0,this.initHand(),this.updateUI()}spawnClearParticles(t){const e=this.renderer,i="#FFD700",s=(n,h)=>{const l=e.padding+n*e.cellSize+e.cellSize/2,r=e.padding+h*e.cellSize+e.cellSize/2;for(let o=0;o<5;o++)this.particles.push(new R(l,r,i))};t.rows.forEach(n=>{for(let h=0;h<d.GRID_SIZE;h++)s(h,n)}),t.cols.forEach(n=>{for(let h=0;h<d.GRID_SIZE;h++)s(n,h)})}updateUI(){const t=document.getElementById("score"),e=document.getElementById("best");t&&(t.innerText=this.score),e&&(e.innerText=this.bestScore)}drawHand(){if(!this.renderer)return;const t=this.renderer.ctx,e=this.renderer.width,i=this.renderer.height-e,s=e+i/2,h=this.renderer.width/3,r=this.renderer.cellSize*.6;for(let o=0;o<3;o++){if(this.dragState.isDragging&&this.dragState.blockIndex===o)continue;const a=this.hand[o];if(!a)continue;const g=o*h+h/2,u=s,f=a.shape[0].length*r,p=a.shape.length*r,w=g-f/2,x=u-p/2;t.fillStyle=a.color,t.shadowBlur=0,a.shape.forEach((y,b)=>{y.forEach((v,I)=>{v&&(this.renderer.roundRect(w+I*r,x+b*r,r-2,r-2,2),t.fill())})})}}}document.addEventListener("DOMContentLoaded",()=>{new k;const c=document.getElementById("help-modal"),t=document.getElementById("help-btn"),e=document.getElementById("close-help");t.addEventListener("click",()=>{c.classList.remove("hidden")}),e.addEventListener("click",()=>{c.classList.add("hidden")}),c.addEventListener("click",i=>{i.target===c&&c.classList.add("hidden")})});
